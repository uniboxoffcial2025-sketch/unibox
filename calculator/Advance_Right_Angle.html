<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Advanced Right Angle Calculator</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <meta name="theme-color" content="#1a1a2e">
  <link rel="manifest" href="manifest.json">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    :root {
      --primary: #4361ee;
      --secondary: #f72585;
      --tertiary: #4cc9f0;
      --dark-bg: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
      --light-bg: linear-gradient(135deg, #e0e0e0 0%, #c9d6ff 100%);
      --dark-container: rgba(30, 30, 46, 0.8);
      --light-container: rgba(255, 255, 255, 0.9);
      --dark-text: #fff;
      --light-text: #333;
      --dark-secondary-text: #cbd5e1;
      --light-secondary-text: #4b5563;
      --dark-result-bg: rgba(255, 255, 255, 0.05);
      --light-result-bg: rgba(0, 0, 0, 0.05);
      --dark-history-bg: rgba(255, 255, 255, 0.05);
      --light-history-bg: rgba(0, 0, 0, 0.05);
      --shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
      --light-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: var(--dark-bg);
      color: var(--dark-text);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 20px;
      transition: background 0.5s ease;
    }
    
    body.light-mode {
      background: var(--light-bg);
      color: var(--light-text);
    }
    
    .app-container {
      width: 100%;
      max-width: 1200px;
      display: grid;
      grid-template-columns: 1fr;
      gap: 20px;
    }
    
    @media (min-width: 900px) {
      .app-container {
        grid-template-columns: 1fr 1fr;
      }
    }
    
    .calculator-panel {
      background: var(--dark-container);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 30px;
      box-shadow: var(--shadow);
      text-align: center;
      border: 1px solid rgba(255, 255, 255, 0.1);
      transition: all 0.3s ease;
    }
    
    body.light-mode .calculator-panel {
      background: var(--light-container);
      border: 1px solid rgba(0, 0, 0, 0.1);
      box-shadow: var(--light-shadow);
    }
    
    .history-panel {
      background: var(--dark-container);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 30px;
      box-shadow: var(--shadow);
      border: 1px solid rgba(255, 255, 255, 0.1);
      transition: all 0.3s ease;
    }
    
    body.light-mode .history-panel {
      background: var(--light-container);
      border: 1px solid rgba(0, 0, 0, 0.1);
      box-shadow: var(--light-shadow);
    }
    
    .logo-container {
      margin-bottom: 20px;
      position: relative;
    }
    
    .logo-triangle {
      transform-origin: center;
      animation: rotate 8s linear infinite;
    }
    
    .logo-circle {
      animation: pulse 2s ease-in-out infinite alternate;
    }
    
    h1 {
      font-size: 2.2rem;
      margin-bottom: 10px;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
      background: linear-gradient(to right, var(--tertiary), var(--primary));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    
    body.light-mode h1 {
      background: linear-gradient(to right, #3a0ca3, var(--primary));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    
    p {
      font-size: 1.1rem;
      margin-bottom: 25px;
      opacity: 0.9;
      color: var(--dark-secondary-text);
    }
    
    body.light-mode p {
      color: var(--light-secondary-text);
    }
    
    .input-group {
      display: flex;
      flex-direction: column;
      gap: 15px;
      margin-bottom: 25px;
    }
    
    input, select {
      padding: 15px;
      border: none;
      border-radius: 12px;
      background: #ffffff;
      color: #1e1e2e;
      font-size: 1.1rem;
      text-align: center;
      transition: all 0.3s ease;
      border: 2px solid transparent;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    }
    
    input:focus, select:focus {
      outline: none;
      border: 2px solid var(--primary);
      transform: scale(1.03);
      box-shadow: 0 5px 15px rgba(67, 97, 238, 0.3);
    }
    
    input::placeholder {
      color: #6b7280;
    }
    
    button {
      padding: 15px 30px;
      border: none;
      border-radius: 12px;
      color: white;
      font-size: 1.2rem;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 5px 15px rgba(67, 97, 238, 0.4);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }
    
    button:hover {
      transform: translateY(-3px);
    }
    
    button:active {
      transform: translateY(1px);
    }
    
    .btn-primary {
      background: linear-gradient(to right, var(--primary), #3a0ca3);
    }
    
    .btn-primary:hover {
      box-shadow: 0 8px 20px rgba(67, 97, 238, 0.6);
    }
    
    .btn-secondary {
      background: linear-gradient(to right, var(--secondary), #b5179e);
      box-shadow: 0 5px 15px rgba(247, 37, 133, 0.4);
    }
    
    .btn-secondary:hover {
      box-shadow: 0 8px 20px rgba(247, 37, 133, 0.6);
    }
    
    .btn-tertiary {
      background: linear-gradient(to right, var(--tertiary), #4895ef);
      box-shadow: 0 5px 15px rgba(76, 201, 240, 0.4);
    }
    
    .btn-tertiary:hover {
      box-shadow: 0 8px 20px rgba(76, 201, 240, 0.6);
    }
    
    .result {
      margin-top: 25px;
      padding: 20px;
      border-radius: 15px;
      background: var(--dark-result-bg);
      font-size: 1.3rem;
      min-height: 70px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
      border: 1px solid rgba(255, 255, 255, 0.1);
      position: relative;
    }
    
    body.light-mode .result {
      background: var(--light-result-bg);
      border: 1px solid rgba(0, 0, 0, 0.1);
    }
    
    .result.highlight {
      background: rgba(255, 255, 255, 0.1);
      transform: scale(1.05);
      animation: fadeIn 0.5s ease;
    }
    
    body.light-mode .result.highlight {
      background: rgba(0, 0, 0, 0.1);
    }
    
    .copy-btn {
      position: absolute;
      right: 10px;
      padding: 8px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 8px;
      border: none;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    .copy-btn:hover {
      background: rgba(255, 255, 255, 0.2);
    }
    
    .formula {
      margin-top: 10px;
      font-size: 1rem;
      opacity: 0.8;
      color: var(--dark-secondary-text);
    }
    
    body.light-mode .formula {
      color: var(--light-secondary-text);
    }
    
    .history-section {
      margin-top: 30px;
      padding-top: 20px;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    body.light-mode .history-section {
      border-top: 1px solid rgba(0, 0, 0, 0.1);
    }
    
    .history-list {
      max-height: 300px;
      overflow-y: auto;
      margin-top: 15px;
      text-align: left;
    }
    
    .history-item {
      padding: 12px 15px;
      margin-bottom: 10px;
      background: var(--dark-history-bg);
      border-radius: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border: 1px solid rgba(255, 255, 255, 0.05);
      animation: slideIn 0.3s ease;
    }
    
    body.light-mode .history-item {
      background: var(--light-history-bg);
      border: 1px solid rgba(0, 0, 0, 0.05);
    }
    
    .history-data {
      flex-grow: 1;
      font-size: 0.95rem;
    }
    
    .history-actions {
      display: flex;
      gap: 8px;
    }
    
    .history-actions button {
      padding: 8px 12px;
      font-size: 0.8rem;
      margin: 0;
    }
    
    .empty-history {
      text-align: center;
      padding: 15px;
      opacity: 0.7;
      color: #94a3b8;
    }
    
    body.light-mode .empty-history {
      color: #6b7280;
    }
    
    .button-group {
      display: flex;
      gap: 10px;
      justify-content: center;
      flex-wrap: wrap;
      margin-top: 15px;
    }
    
    .action-buttons {
      display: flex;
      gap: 15px;
      justify-content: center;
      margin: 20px 0;
    }
    
    .action-buttons button {
      flex: 1;
      min-width: 140px;
    }
    
    .mode-selector {
      margin-bottom: 20px;
    }
    
    .mode-selector select {
      width: 100%;
      padding: 12px;
    }
    
    .unit-selector {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }
    
    .unit-selector select {
      flex: 1;
      padding: 12px;
    }
    
   .canvas-container {
  margin: 20px 0;
  display: flex;
  justify-content: center; /* horizontal center */
  align-items: center;     /* vertical center (container height অনুযায়ী) */
  width: 100%;
}

canvas {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 10px;
  border: 1px solid rgba(255, 255, 255, 0.1);
  display: block;
  margin: 0 auto;   /* canvas কে container এর মধ্যে সেন্টার করবে */
  
}

body.light-mode canvas {
  background: rgba(0, 0, 0, 0.05);
  border: 1px solid rgba(0, 0, 0, 0.1);
}
    
    .theme-toggle {
      position: fixed;
      top: 20px;
      right: 20px;
      background: rgba(255, 255, 255, 0.1);
      border: none;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s ease;
      z-index: 100;
    }
    
    .theme-toggle:hover {
      background: rgba(255, 255, 255, 0.2);
      transform: rotate(30deg);
    }
    
    .voice-input {
      position: relative;
    }
    
    .voice-btn {
      position: absolute;
      right: 10px;
      top: 50%;
      transform: translateY(-50%);
      background: transparent;
      border: none;
      color: var(--primary);
      cursor: pointer;
      padding: 5px;
    }
    
    .search-history {
      margin-bottom: 15px;
    }
    
    .export-buttons {
      display: flex;
      gap: 10px;
      margin-top: 15px;
    }
    
    .export-buttons button {
      flex: 1;
      padding: 10px;
      font-size: 0.9rem;
    }
    
    .panel-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    
    .panel-title {
      font-size: 1.5rem;
      font-weight: bold;
      background: linear-gradient(to right, var(--tertiary), var(--primary));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    
    @keyframes rotate {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }
    
    @keyframes pulse {
      from { transform: scale(1); opacity: 0.7; }
      to { transform: scale(1.1); opacity: 1; }
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: scale(0.95); }
      to { opacity: 1; transform: scale(1.05); }
    }
    
    @keyframes slideIn {
      from { opacity: 0; transform: translateX(-20px); }
      to { opacity: 1; transform: translateX(0); }
    }
    
    @media (max-width: 600px) {
      .calculator-panel, .history-panel {
        padding: 20px;
      }
      
      h1 {
        font-size: 1.8rem;
      }
      
      .button-group {
        flex-direction: column;
      }
      
      .action-buttons {
        flex-direction: column;
      }
      
      .unit-selector {
        flex-direction: column;
      }
      
      .export-buttons {
        flex-direction: column;
      }
      
      .app-container {
        grid-template-columns: 1fr;
      }
    }
    
    
  </style>
</head>
<body>
  <button class="theme-toggle" id="themeToggle">
    <i class="fas fa-moon"></i>
  </button>

  <div class="app-container">
    <div class="calculator-panel">
      <div class="panel-header">
        <div class="panel-title">Advance Triangle Calculator</div>
      </div>
      
      <div class="logo-container">
        <svg width="150" height="150" viewBox="0 0 200 200">
          <!-- Animated Triangle -->
          <polygon class="logo-triangle" points="100,40 160,160 40,160" stroke="#4361ee" stroke-width="5" fill="none" />
          
          <!-- Animated Circles -->
          <circle class="logo-circle" cx="100" cy="100" r="30" stroke="#4cc9f0" stroke-width="3" fill="none" />
          <circle class="logo-circle" cx="100" cy="100" r="20" stroke="#f72585" stroke-width="2" fill="none" />
          
          <!-- Right Angle Symbol -->
          <path d="M85,145 L85,160 L70,160" stroke="#4361ee" stroke-width="3" fill="none" />
        </svg>
      </div>
      
        <div class="canvas-container">
        <canvas id="triangleCanvas" width="250" height="150"></canvas>
      </div>
      
      <div class="result" id="result">
        Result will be shown here
        <button class="copy-btn" onclick="copyResult()"><i class="fas fa-copy"></i></button>
      </div>
      
      <div class="formula" id="formula">Formula: c = √(a² + b²)</div>
    </div>
      
      <div class="mode-selector">
        <select id="calculationMode">
          <option value="hypotenuse">Calculate Hypotenuse (a, b → c)</option>
          <option value="sideA">Calculate Side A (c, b → a)</option>
          <option value="sideB">Calculate Side B (c, a → b)</option>
        </select>
      </div>
      
      <div class="unit-selector">
        <select id="unit">
          <option value="cm">Centimeters (cm)</option>
          <option value="m">Meters (m)</option>
          <option value="in">Inches (in)</option>
          <option value="ft">Feet (ft)</option>
        </select>
      </div>
      
      <div class="input-group">
        <div class="voice-input">
          <input type="number" id="a" placeholder="Enter side (a)...." step="any">
          <button class="voice-btn" id="voiceA"><i class="fas fa-microphone"></i></button>
        </div>
        <div class="voice-input">
          <input type="number" id="b" placeholder="Enter side (b)...." step="any">
          <button class="voice-btn" id="voiceB"><i class="fas fa-microphone"></i></button>
        </div>
        <div class="voice-input" id="cInputContainer" style="display: none;">
          <input type="number" id="c" placeholder="Enter hypotenuse (c)...." step="any">
          <button class="voice-btn" id="voiceC"><i class="fas fa-microphone"></i></button>
        </div>
      </div>
      
      <div class="action-buttons">
        <button class="btn-primary" onclick="calculate()">
          <i class="fas fa-calculator"></i> Calculate
        </button>
        <button class="btn-tertiary" onclick="resetCalculator()">
          <i class="fas fa-redo"></i> Reset
        </button>
      </div>
      
    
      
      
    
    <div class="history-panel">
      <div class="panel-header">
        <div class="panel-title">Calculation History</div>
      </div>
      
      <div class="search-history">
        <input type="text" id="searchHistory" placeholder="Search history..." oninput="filterHistory()">
      </div>
      
      <div class="history-list" id="historyList">
        <div class="empty-history">No calculations yet</div>
      </div>
      
      <div class="export-buttons">
        <button class="btn-tertiary" onclick="exportJSON()">
          <i class="fas fa-file-code"></i> Export JSON
        </button>
        <button class="btn-tertiary" onclick="exportCSV()">
          <i class="fas fa-file-csv"></i> Export CSV
        </button>
        <button class="btn-secondary" onclick="clearHistory()">
          <i class="fas fa-trash"></i> Clear History
        </button>
      </div>
    </div>
  </div>

  <script>
    // Load calculations from localStorage
    let calculations = JSON.parse(localStorage.getItem('calculations')) || [];
    let currentTheme = localStorage.getItem('theme') || 'dark';
    
    // Set initial theme
    if (currentTheme === 'light') {
      document.body.classList.add('light-mode');
      document.getElementById('themeToggle').innerHTML = '<i class="fas fa-sun"></i>';
    }
    
    // Theme toggle functionality
    document.getElementById('themeToggle').addEventListener('click', function() {
      document.body.classList.toggle('light-mode');
      if (document.body.classList.contains('light-mode')) {
        this.innerHTML = '<i class="fas fa-sun"></i>';
        localStorage.setItem('theme', 'light');
      } else {
        this.innerHTML = '<i class="fas fa-moon"></i>';
        localStorage.setItem('theme', 'dark');
      }
    });
    
    // Mode selector functionality
    document.getElementById('calculationMode').addEventListener('change', function() {
      updateInputFields();
      updateFormula();
      drawTriangle(); // Redraw triangle based on new mode
    });
    
    function updateInputFields() {
      const mode = document.getElementById('calculationMode').value;
      const cInputContainer = document.getElementById('cInputContainer');
      
      if (mode === 'hypotenuse') {
        document.getElementById('a').placeholder = 'Enter side (a)....';
        document.getElementById('b').placeholder = 'Enter side (b)....';
        cInputContainer.style.display = 'none';
      } else if (mode === 'sideA') {
        document.getElementById('a').placeholder = 'Calculate side (a)....';
        document.getElementById('b').placeholder = 'Enter side (b)....';
        cInputContainer.style.display = 'block';
      } else if (mode === 'sideB') {
        document.getElementById('a').placeholder = 'Enter side (a)....';
        document.getElementById('b').placeholder = 'Calculate side (b)....';
        cInputContainer.style.display = 'block';
      }
    }
    
    function updateFormula() {
      const mode = document.getElementById('calculationMode').value;
      const formulaElement = document.getElementById('formula');
      
      if (mode === 'hypotenuse') {
        formulaElement.textContent = 'Formula: c = √(a² + b²)';
      } else if (mode === 'sideA') {
        formulaElement.textContent = 'Formula: a = √(c² - b²)';
      } else if (mode === 'sideB') {
        formulaElement.textContent = 'Formula: b = √(c² - a²)';
      }
    }
    
    // Voice input functionality
    if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      const recognition = new SpeechRecognition();
      recognition.continuous = false;
      recognition.lang = 'en-US';
      
      let currentVoiceInput = null;
      
      document.getElementById('voiceA').addEventListener('click', function() {
        currentVoiceInput = 'a';
        recognition.start();
      });
      
      document.getElementById('voiceB').addEventListener('click', function() {
        currentVoiceInput = 'b';
        recognition.start();
      });
      
      document.getElementById('voiceC').addEventListener('click', function() {
        currentVoiceInput = 'c';
        recognition.start();
      });
      
      recognition.onresult = function(event) {
        const transcript = event.results[0][0].transcript;
        const value = parseFloat(transcript.match(/\d+(\.\d+)?/)[0]);
        
        if (currentVoiceInput && value) {
          document.getElementById(currentVoiceInput).value = value;
        }
      };
      
      recognition.onerror = function(event) {
        console.error('Speech recognition error', event.error);
      };
    } else {
      // Hide voice buttons if not supported
      document.querySelectorAll('.voice-btn').forEach(btn => {
        btn.style.display = 'none';
      });
    }
    
    // Draw triangle on canvas
    function drawTriangle(a = 3, b = 4, c = 5) {
      const canvas = document.getElementById('triangleCanvas');
      const ctx = canvas.getContext('2d');
      const padding = 20;
      const width = canvas.width - padding * 2;
      const height = canvas.height - padding * 2;
      
      // Clear canvas
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      
      // Determine scale to fit triangle in canvas
      const maxSide = Math.max(a, b, c);
      const scale = Math.min(width, height) / maxSide;
      
      // Calculate coordinates
      const aScaled = a * scale;
      const bScaled = b * scale;
      
      // Start drawing from bottom left
      const startX = padding;
      const startY = canvas.height - padding;
      
      ctx.beginPath();
      ctx.moveTo(startX, startY);
      ctx.lineTo(startX, startY - bScaled); // Vertical line (side a or b)
      ctx.lineTo(startX + aScaled, startY); // Horizontal line (side a or b)
      ctx.closePath();
      
      // Draw triangle
      ctx.strokeStyle = '#4361ee';
      ctx.lineWidth = 3;
      ctx.stroke();
      
      // Draw right angle indicator
      ctx.beginPath();
      ctx.moveTo(startX + 15, startY - 15);
      ctx.lineTo(startX + 15, startY);
      ctx.lineTo(startX, startY - 15);
      ctx.strokeStyle = '#f72585';
      ctx.lineWidth = 2;
      ctx.stroke();
      
      // Label sides
      ctx.font = '14px Arial';
      ctx.fillStyle = document.body.classList.contains('light-mode') ? '#333' : '#fff';
      ctx.fillText(`${a}`, startX + aScaled / 2 - 10, startY + 15);
      ctx.fillText(`${b}`, startX - 15, startY - bScaled / 2);
      ctx.fillText(`${c.toFixed(2)}`, startX + aScaled / 2 - 10, startY - bScaled / 2 - 10);
    }
    
    // Display history
    function renderHistory() {
      const historyList = document.getElementById('historyList');
      const searchTerm = document.getElementById('searchHistory').value.toLowerCase();
      
      let filteredCalculations = calculations;
      if (searchTerm) {
        filteredCalculations = calculations.filter(calc => 
          calc.a.toString().includes(searchTerm) || 
          calc.b.toString().includes(searchTerm) || 
          calc.c.toString().includes(searchTerm) ||
          calc.mode.includes(searchTerm)
        );
      }
      
      if (filteredCalculations.length === 0) {
        historyList.innerHTML = '<div class="empty-history">No calculations found</div>';
        return;
      }
      
      historyList.innerHTML = '';
      filteredCalculations.forEach((calc, index) => {
        const historyItem = document.createElement('div');
        historyItem.className = 'history-item';
        
        let displayText = '';
        if (calc.mode === 'hypotenuse') {
          displayText = `a: ${calc.a}${calc.unit}, b: ${calc.b}${calc.unit} → c: ${calc.c}${calc.unit}`;
        } else if (calc.mode === 'sideA') {
          displayText = `c: ${calc.c}${calc.unit}, b: ${calc.b}${calc.unit} → a: ${calc.a}${calc.unit}`;
        } else if (calc.mode === 'sideB') {
          displayText = `c: ${calc.c}${calc.unit}, a: ${calc.a}${calc.unit} → b: ${calc.b}${calc.unit}`;
        }
        
        historyItem.innerHTML = `
          <div class="history-data">
            ${displayText} (${calc.mode})
          </div>
          <div class="history-actions">
            <button class="btn-tertiary" onclick="editCalculation(${calculations.indexOf(calc)})" style="padding: 6px 10px; font-size: 0.8rem;">
              <i class="fas fa-edit"></i>
            </button>
            <button class="btn-secondary" onclick="deleteCalculation(${calculations.indexOf(calc)})" style="padding: 6px 10px; font-size: 0.8rem;">
              <i class="fas fa-trash"></i>
            </button>
          </div>
        `;
        historyList.appendChild(historyItem);
      });
    }
    
    function filterHistory() {
      renderHistory();
    }
    
    // Calculate based on selected mode
    function calculate() {
      const mode = document.getElementById('calculationMode').value;
      const unit = document.getElementById('unit').value;
      let a = parseFloat(document.getElementById("a").value);
      let b = parseFloat(document.getElementById("b").value);
      let c = parseFloat(document.getElementById("c").value);
      
      const resultElement = document.getElementById("result");
      
      let result, calculatedValue;
      
      if (mode === 'hypotenuse') {
        if (isNaN(a) || isNaN(b) || a <= 0 || b <= 0) {
          showError("Please enter two valid positive numbers.");
          return;
        }
        calculatedValue = Math.sqrt(a*a + b*b);
        result = `Hypotenuse (c) = <strong>${calculatedValue.toFixed(2)}${unit}</strong>`;
      } 
      else if (mode === 'sideA') {
        if (isNaN(c) || isNaN(b) || c <= 0 || b <= 0 || c <= b) {
          showError("Please enter valid values. Hypotenuse must be greater than side b.");
          return;
        }
        calculatedValue = Math.sqrt(c*c - b*b);
        result = `Side (a) = <strong>${calculatedValue.toFixed(2)}${unit}</strong>`;
        a = calculatedValue; // For drawing the triangle
      } 
      else if (mode === 'sideB') {
        if (isNaN(c) || isNaN(a) || c <= 0 || a <= 0 || c <= a) {
          showError("Please enter valid values. Hypotenuse must be greater than side a.");
          return;
        }
        calculatedValue = Math.sqrt(c*c - a*a);
        result = `Side (b) = <strong>${calculatedValue.toFixed(2)}${unit}</strong>`;
        b = calculatedValue; // For drawing the triangle
      }
      
      resultElement.innerHTML = result + '<button class="copy-btn" onclick="copyResult()"><i class="fas fa-copy"></i></button>';
      resultElement.classList.add("highlight");
      setTimeout(() => resultElement.classList.remove("highlight"), 1000);
      
      // Draw triangle visualization
      if (mode === 'hypotenuse') {
        drawTriangle(a, b, calculatedValue);
      } else if (mode === 'sideA') {
        drawTriangle(calculatedValue, b, c);
      } else if (mode === 'sideB') {
        drawTriangle(a, calculatedValue, c);
      }
      
      // Save to history
      calculations.push({ 
        a: a, 
        b: b, 
        c: (mode === 'hypotenuse') ? calculatedValue.toFixed(2) : c,
        calculated: calculatedValue.toFixed(2),
        mode: mode,
        unit: unit,
        timestamp: new Date().toISOString()
      });
      localStorage.setItem('calculations', JSON.stringify(calculations));
      
      // Update history display
      renderHistory();
    }
    
    function showError(message) {
      const resultElement = document.getElementById("result");
      resultElement.innerText = message;
      resultElement.classList.add("highlight");
      setTimeout(() => {
        resultElement.classList.remove("highlight");
        resultElement.innerHTML = 'Result will be shown here<button class="copy-btn" onclick="copyResult()"><i class="fas fa-copy"></i></button>';
      }, 2000);
    }
    
    // Reset calculator inputs
    function resetCalculator() {
      document.getElementById("a").value = "";
      document.getElementById("b").value = "";
      document.getElementById("c").value = "";
      document.getElementById("result").innerHTML = "Result will be shown here<button class=\"copy-btn\" onclick=\"copyResult()\"><i class=\"fas fa-copy\"></i></button>";
      drawTriangle(); // Reset to default triangle
    }
    
    // Copy result to clipboard
    function copyResult() {
      const resultText = document.getElementById("result").innerText;
      navigator.clipboard.writeText(resultText).then(() => {
        const copyBtn = document.querySelector('.copy-btn');
        copyBtn.innerHTML = '<i class="fas fa-check"></i>';
        setTimeout(() => {
          copyBtn.innerHTML = '<i class="fas fa-copy"></i>';
        }, 2000);
      });
    }
    
    // Clear all history
    function clearHistory() {
      if (confirm("Are you sure you want to clear all history?")) {
        calculations = [];
        localStorage.removeItem('calculations');
        renderHistory();
      }
    }
    
    // Delete a specific calculation
    function deleteCalculation(index) {
      calculations.splice(index, 1);
      localStorage.setItem('calculations', JSON.stringify(calculations));
      renderHistory();
    }
    
    // Edit a calculation
    function editCalculation(index) {
      const calc = calculations[index];
      
      // Set the mode
      document.getElementById('calculationMode').value = calc.mode;
      updateInputFields();
      updateFormula();
      
      // Fill the inputs
      document.getElementById("a").value = calc.a;
      document.getElementById("b").value = calc.b;
      
      if (calc.mode !== 'hypotenuse') {
        document.getElementById("c").value = calc.c;
        document.getElementById('cInputContainer').style.display = 'block';
      }
      
      // Set the unit
      document.getElementById('unit').value = calc.unit;
      
      // Recalculate and update visualization
      if (calc.mode === 'hypotenuse') {
        const c = Math.sqrt(calc.a * calc.a + calc.b * calc.b);
        document.getElementById("result").innerHTML = `Hypotenuse (c) = <strong>${c.toFixed(2)}${calc.unit}</strong><button class="copy-btn" onclick="copyResult()"><i class="fas fa-copy"></i></button>`;
        drawTriangle(calc.a, calc.b, c);
      } else if (calc.mode === 'sideA') {
        const a = Math.sqrt(calc.c * calc.c - calc.b * calc.b);
        document.getElementById("result").innerHTML = `Side (a) = <strong>${a.toFixed(2)}${calc.unit}</strong><button class="copy-btn" onclick="copyResult()"><i class="fas fa-copy"></i></button>`;
        drawTriangle(a, calc.b, calc.c);
      } else if (calc.mode === 'sideB') {
        const b = Math.sqrt(calc.c * calc.c - calc.a * calc.a);
        document.getElementById("result").innerHTML = `Side (b) = <strong>${b.toFixed(2)}${calc.unit}</strong><button class="copy-btn" onclick="copyResult()"><i class="fas fa-copy"></i></button>`;
        drawTriangle(calc.a, b, calc.c);
      }
    }
    
    // Export history as JSON
    function exportJSON() {
      const dataStr = JSON.stringify(calculations, null, 2);
      const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
      
      const exportFileDefaultName = 'triangle-calculations.json';
      
      const linkElement = document.createElement('a');
      linkElement.setAttribute('href', dataUri);
      linkElement.setAttribute('download', exportFileDefaultName);
      linkElement.click();
    }
    
    // Export history as CSV
    function exportCSV() {
      let csvContent = "Mode,a,b,c,Calculated,Unit,Timestamp\n";
      
      calculations.forEach(calc => {
        csvContent += `${calc.mode},${calc.a},${calc.b},${calc.c},${calc.calculated},${calc.unit},${calc.timestamp}\n`;
      });
      
      const encodedUri = encodeURI('data:text/csv;charset=utf-8,' + csvContent);
      const link = document.createElement('a');
      link.setAttribute('href', encodedUri);
      link.setAttribute('download', 'triangle-calculations.csv');
      document.body.appendChild(link);
      
      link.click();
      document.body.removeChild(link);
    }
    
    // Allow calculation on Enter key press, reset on Escape
    document.addEventListener('keydown', function(event) {
      if (event.key === 'Enter') {
        calculate();
      } else if (event.key === 'Escape') {
        resetCalculator();
      }
    });
    
    // Initial render of history and triangle
    renderHistory();
    drawTriangle();
    updateInputFields();
    
    // PWA Service Worker Registration
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', function() {
        navigator.serviceWorker.register('sw.js').then(function(registration) {
          console.log('SW registered: ', registration);
        }).catch(function(registrationError) {
          console.log('SW registration failed: ', registrationError);
        });
      });
    }
  </script>
</body>
</html>